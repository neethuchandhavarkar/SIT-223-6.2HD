pipeline {
    agent any 

    stages {
        stage('Checkout') {
            steps {
                // Checkout your source code from your repository
                checkout scm
            }
        }

        stage('Build') {
            steps {
                // Build your code and create a build artifact
                bat 'mvn clean package' // Adjust this command based on your build tool
            }
            post {
                success {
                    archiveArtifacts artifacts: '**/*.jar', fingerprint: true // Archive the JAR file
                }
            }
        }

        stage('Test') {
            steps {
                script {
                    try {
                        // Run automated tests using JUnit
                        bat 'mvn test' // Adjust based on your testing framework
                    } catch (Exception e) {
                        currentBuild.result = 'UNSTABLE' // Mark build as unstable if tests fail
                    }
                }
            }
            post {
                always {
                    junit '**/target/surefire-reports/*.xml' // Publish test results
                }
            }
        }

        stage('Code Quality Analysis') {
            steps {
                script {
                    def scannerHome = tool 'SonarQube Scanner' // Adjust based on your SonarQube setup
                    bat "${scannerHome}/bin/sonar-scanner.bat -Dsonar.projectKey=your_project_key -Dsonar.sources=. -Dsonar.host.url=http://your-sonarqube-server -Dsonar.login=your_token"
                }
            }
        }
    }
    
    post {
        always {
            echo 'Pipeline completed.'
        }
    }
}
